<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CercaClick - Cat√°logo Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="bg-gradient-to-r from-orange-500 to-amber-600 pt-10 pb-20 px-6 rounded-b-[3rem] shadow-xl text-center">
        <div class="w-20 h-20 bg-white rounded-full mx-auto mb-4 flex items-center justify-center shadow-inner">
            <i class="fas fa-bread-slice text-orange-500 text-3xl"></i>
        </div>
        <h1 id="storeTitle" class="text-white text-3xl font-black uppercase tracking-tighter">Cargando...</h1>
        <p class="text-orange-100 text-sm mt-1">Haz tu pedido y rec√≠belo en casa üõµ</p>
    </div>

    <div class="max-w-md mx-auto -mt-10 px-4 pb-10">
        <div id="productList" class="grid grid-cols-1 gap-4">
            <div class="bg-white p-6 rounded-2xl shadow-sm text-center text-gray-400">
                <i class="fas fa-spinner fa-spin mr-2"></i> Actualizando men√∫...
            </div>
        </div>
    </div>

    <script>
        // 1. OBTENER EL ID DEL NEGOCIO DESDE LA URL (Ej: ?store=panaderiadonpepe)
        const urlParams = new URLSearchParams(window.location.search);
        const storeId = urlParams.get('store');

        async function loadCatalog() {
            const list = document.getElementById('productList');
            const title = document.getElementById('storeTitle');

           if (!storeId) return;

            try {
                // 2. BUSCAR EN FIREBASE USANDO EL ID LIMPIO
                const response = await fetch(`https://cercaclick-default-rtdb.firebaseio.com/${storeId}.json`);
                const data = await response.json();

                if (data && data.items) {
                    document.getElementById('storeTitle').innerText = data.info.StoreName;
                    title.innerText = "No encontrado";
                    list.innerHTML = `<div class='bg-white p-6 rounded-2xl shadow-sm text-center text-gray-500'>El negocio "${storeId}" a√∫n no tiene productos publicados.</div>`;
                    return;
                }

                // 3. ACTUALIZAR INFO DEL NEGOCIO DESDE FIREBASE
                title.innerText = data.info.StoreName || "Mi Negocio";
                const storePhone = data.info.WhatsAppPhone || "573001234567";
                
                list.innerHTML = "";

                // 4. GENERAR LAS TARJETAS DE PRODUCTOS
                data.items.forEach(item => {
                    const card = `
                        <div class="bg-white rounded-2xl p-5 shadow-sm border border-gray-100 flex justify-between items-center transform active:scale-95 transition-transform">
                            <div class="flex-1">
                                <span class="text-[10px] font-bold text-orange-500 uppercase tracking-widest bg-orange-50 px-2 py-1 rounded-md">${item.Category}</span>
                                <h3 class="text-lg font-bold text-gray-800 mt-1">${item.Name}</h3>
                                <p class="text-gray-900 font-extrabold text-xl mt-1">$${item.Price}</p>
                            </div>
                            <button onclick="order('${item.Name}', ${item.Price}, '${storePhone}')" 
                                    class="bg-green-500 hover:bg-green-600 text-white w-12 h-12 rounded-2xl shadow-lg flex items-center justify-center transition-colors">
                                <i class="fab fa-whatsapp text-2xl"></i>
                            </button>
                        </div>`;
                    list.innerHTML += card;
                });
            } catch (e) {
                console.error("Error", e);
                list.innerHTML = "<div class='bg-white p-6 rounded-2xl shadow-sm text-center text-red-500'>Error al conectar con la base de datos.</div>";
            }
        }

        function order(name, price, phone) {
            const msg = encodeURIComponent(`*NUEVO PEDIDO DESDE EL CAT√ÅLOGO*\n\n‚úÖ *Producto:* ${name}\nüí∞ *Price:* $${price}\n\n¬øMe confirma la disponibilidad?`);
            window.location.href = `https://wa.me/${phone}?text=${msg}`;
        }

        loadCatalog();
    </script>
</body>
</html>

