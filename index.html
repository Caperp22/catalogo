<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CercaClick - Cat√°logo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 pb-40">
    <div id="headerDiv" class="pt-10 pb-20 px-6 rounded-b-[3rem] shadow-xl text-center transition-all duration-500">
        <img id="mainLogo" src="" class="w-16 h-16 bg-white rounded-full mx-auto mb-4 p-2 shadow-inner">
        <h1 id="storeTitle" class="text-white text-2xl font-black uppercase tracking-tighter">Cargando...</h1>
    </div>

    <div class="max-w-md mx-auto -mt-10 px-4">
        <div id="productList" class="grid gap-4"></div>

        <div id="deliveryInfo" class="mt-8 bg-white rounded-3xl p-6 shadow-md hidden">
            <h3 class="font-bold mb-2 text-gray-700"><i class="fas fa-map-marker-alt mr-2"></i>¬øA d√≥nde lo llevamos?</h3>
            <input type="text" id="clientAddress" placeholder="Tu direcci√≥n exacta..." class="w-full border p-3 rounded-xl">
        </div>
    </div>

    <div id="cartBar" class="fixed bottom-6 left-4 right-4 bg-green-600 text-white rounded-3xl p-4 shadow-2xl flex justify-between items-center transform translate-y-40 transition-all">
        <div>
            <span id="cartCount" class="text-xs block opacity-80">0 productos</span>
            <span id="cartTotal" class="text-xl font-bold">$0</span>
        </div>
        <button onclick="sendOrder()" class="bg-white text-green-700 px-6 py-2 rounded-2xl font-bold">Pedir por WhatsApp</button>
    </div>

    <script>
        const storeId = new URLSearchParams(window.location.search).get('store');
        let cart = {}, phone = "";

        async function init() {
            if (!storeId) return;
            const res = await fetch(`https://cercaclick-default-rtdb.firebaseio.com/${storeId}.json`);
            const data = await res.json();
            
            if (!data) return;

            // Ajuste de Identidad Visual
            const color = data.info.PrimaryColor || "#E67E22";
            document.getElementById('headerDiv').style.background = color;
            document.getElementById('storeTitle').innerText = data.info.StoreName;
            document.getElementById('mainLogo').src = data.info.LogoUrl || "https://cdn-icons-png.flaticon.com/512/706/706164.png";
            phone = data.info.WhatsAppPhone;

            const list = document.getElementById('productList');
            data.items.forEach(item => {
                list.innerHTML += `
                    <div class="bg-white p-4 rounded-2xl shadow-sm flex justify-between items-center border border-gray-100">
                        <div>
                            <h3 class="font-bold text-gray-800">${item.Name}</h3>
                            <p class="text-green-600 font-bold">$${item.Price}</p>
                        </div>
                        <div class="flex items-center bg-gray-100 rounded-xl">
                            <button onclick="qty('${item.Name}',${item.Price},-1)" class="p-2 px-4 text-gray-400">-</button>
                            <span id="q-${item.Name.replace(/\s/g,'')}" class="font-bold">0</span>
                            <button onclick="qty('${item.Name}',${item.Price},1)" class="p-2 px-4 text-green-600">+</button>
                        </div>
                    </div>`;
            });
        }

        function qty(name, price, d) {
            if (!cart[name]) cart[name] = { p: price, q: 0 };
            cart[name].q = Math.max(0, cart[name].q + d);
            document.getElementById(`q-${name.replace(/\s/g,'')}`).innerText = cart[name].q;
            updateUI();
        }

        function updateUI() {
            let t = 0, c = 0;
            for (let k in cart) { t += cart[k].p * cart[k].q; c += cart[k].q; }
            document.getElementById('cartTotal').innerText = `$${t}`;
            document.getElementById('cartCount').innerText = `${c} productos`;
            document.getElementById('cartBar').style.transform = c > 0 ? "translateY(0)" : "translateY(160px)";
            document.getElementById('deliveryInfo').style.display = c > 0 ? "block" : "none";
        }

        function sendOrder() {
            const addr = document.getElementById('clientAddress').value;
            if (!addr) return alert("Ingresa tu direcci√≥n");
            let msg = `*NUEVO PEDIDO*\n`, total = 0;
            for (let k in cart) {
                if (cart[k].q > 0) {
                    msg += `‚úÖ ${cart[k].q}x ${k} ($${cart[k].p * cart[k].q})\n`;
                    total += cart[k].p * cart[k].q;
                }
            }
            msg += `\nüí∞ *Total: $${total}*\nüìç *Entregar en:* ${addr}`;
            window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`;
        }

        init();
    </script>
</body>
</html>
